---
title: "PHPã§ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’ã‚„ã£ã¦ã¿ã‚‹"
emoji: "ğŸŒ¿"
type: "tech"
topics:
  - "php"
  - "phpunit"
  - "pest"
  - "ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆ"
published: true
published_at: "2024-08-24 12:49"
---

## ã¯ã˜ã‚ã«

PHPUnitã¨Pestã®ãã‚Œãã‚Œã§ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’ã‚„ã£ã¦ã¿ã‚‹ã€‚

## ç’°å¢ƒ

- PHP 8.3.10

## ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã¨ã¯

æŒ‡å®šã•ã‚ŒãŸæœŸå¾…å€¤ã¨ä¿å­˜ã—ãŸåŒã˜å€¤ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’æ¯”è¼ƒã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã€‚
**ä½•ã‚‚ã—ã¦ã„ãªã„ã®ã«å£Šã‚ŒãŸ**ãªã©äºˆæœŸã—ã¦ã„ãªã„å¤‰æ›´ã‚’æ—©æœŸã«ç™ºè¦‹ã™ã‚‹å ´åˆã«ä¾¿åˆ©ãªæ–¹æ³•ã§ã™ã€‚

## ã‚„ã£ã¦ã¿ã‚‹

ã§ã¯ã€ãã‚Œãã‚Œã‚„ã£ã¦ã¿ã¾ã™ã€‚

### ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

ä»Šå›ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã§ä½¿ã†ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚
é©å½“ãªjsonã‚’è¿”ã™ã ã‘ã®ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

```php:src/functions.php
<?php

declare(strict_types=1);

function json_render(): string
{
    $values = [
        [
            'name' => 'ã‚Šã‚“ã”',
            'price' => 150,
            "stock" => 10,
        ],
        [
            'name' => 'ãƒãƒŠãƒŠ',
            'price' => 200,
            "stock" => 5,
        ],
        [
            'name' => 'ã¿ã‹ã‚“',
            'price' => 120,
            "stock" => 8,
        ],
    ];
    return json_encode($values);
}
```

### PHPUnitã§ã‚„ã£ã¦ã¿ã‚‹

PHPUnitã¯ä¸‹è¨˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã§å®Ÿç¾ã§ãã¾ã™ã€‚

https://github.com/spatie/phpunit-snapshot-assertions

PHPUnitã¨ä¸€ç·’ã«phpunit-snapshot-assertionsã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash
composer require --dev phpunit/phpunit spatie/phpunit-snapshot-assertions
```

ã“ã®è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ã‚‹æ™‚ç‚¹ã§ã¯ã€ãã‚Œãã‚Œä¸‹è¨˜ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã—ãŸã€‚

```bash
phpunit/phpunit                    11.3.1
spatie/phpunit-snapshot-assertions 5.1.6
```

ã¤ãã«ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ä½œã‚Šã¾ã™ã€‚
phpunit-snapshot-assertionsã‚’ä½¿ã£ãŸå ´åˆã¯æ¬¡ã®ã‚ˆã†ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™ã€‚

å¤§äº‹ãªã¨ã“ã‚ã«â­ï¸ã‚’ã¤ã‘ã¦ã¿ã¾ã—ãŸã€‚

```php:tests/SnapshotTest.php
<?php

declare(strict_types=1);

namespace Tests;

use PHPUnit\Framework\Attributes\Test;
use PHPUnit\Framework\TestCase;
use Spatie\Snapshots\MatchesSnapshots; // â­ï¸

class SnapshotTest extends TestCase
{
    use MatchesSnapshots; // â­ï¸â­ï¸

    #[Test]
    public function snapshot(): void
    {
        $this->assertMatchesJsonSnapshot(json_render()); // â­ï¸â­ï¸â­ï¸
    }
}
```

ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’è¡Œã†ãŸã‚ã®traitã®èª­ã¿è¾¼ã¿ã‚’è¿½åŠ ã—ã¦ã€å°‚ç”¨ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ã€‚
`assertMatchesJsonSnapshot`ãƒ¡ã‚½ãƒƒãƒ‰ã¯jsonæ–‡å­—åˆ—ã«å¯¾ã—ã¦ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’è¡Œã†ãŸã‚ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚

ãã®ä»–ã«ã‚‚è‰²ã€…ã‚ã‚‹ã®ã§ã€ãã‚Œã¯[github](https://github.com/spatie/phpunit-snapshot-assertions?tab=readme-ov-file#usage)ã®ã»ã†ã‚’è¦‹ã¦ãã ã•ã„ã€‚

ã“ã‚Œã ã‘ã§ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã®ã§å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

```bash
vendor/bin/phpunit tests/SnapshotTest.php 

PHPUnit 11.3.1 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.3.10

I                                                                   1 / 1 (100%)

Time: 00:00.016, Memory: 8.00 MB

OK, but there were issues!
Tests: 1, Assertions: 3, Incomplete: 1.
```

åˆå›å®Ÿè¡Œã§ã¯ã¾ã ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãŒä½œæˆã•ã‚Œã¦ã„ãªã„ã®ã§ã€å®Ÿè¡Œçµæœã¯`I`ï¼ˆæœªå®Œäº†ï¼‰ã«ãªã‚Šã¾ã™ã€‚

å®Ÿè¡Œã™ã‚‹ã¨SnapshotTest.phpã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`__snapshots__`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒã§ãã¦ã„ã¾ã™ã€‚
ã“ã“ã«ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆç”¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã€ä»Šå›ã ã¨`SnapshotTest__snapshot__1.json`ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

```bash
tree tests

tests
â”œâ”€â”€ SnapshotTest.php
â””â”€â”€ __snapshots__
    â””â”€â”€ SnapshotTest__snapshot__1.json <- ã“ã‚ŒãŒä½œæˆã•ã‚Œã‚‹
```

ä¸­èº«ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚
ãªãŠã€æ—¥æœ¬èªã®æ–‡å­—åˆ—ã¯Unicodeã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚Œã¦ã„ã¾ã™ã­ã€‚
å¤‰æ›ã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ã®ã¯ã¾ãŸåˆ¥ã®æ©Ÿä¼šã«ã‚„ã£ã¦ã¿ã¾ã™ã€‚

```json:tests/__snapshots__/SnapshotTest__snapshot__1.json
[
    {
        "name": "\u308a\u3093\u3054",
        "price": 150,
        "stock": 10
    },
    {
        "name": "\u30d0\u30ca\u30ca",
        "price": 200,
        "stock": 5
    },
    {
        "name": "\u307f\u304b\u3093",
        "price": 120,
        "stock": 8
    }
]
```

ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚ŒãŸå¾Œã«ã‚‚ã†1å›å®Ÿè¡Œã™ã‚‹ã¨ã€‚ã€‚ã€‚

```
vendor/bin/phpunit tests/SnapshotTest.php

PHPUnit 11.3.1 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.3.10

.                                                                   1 / 1 (100%)

Time: 00:00.009, Memory: 8.00 MB

OK (1 test, 3 assertions)
```

æˆåŠŸã—ã¾ã™ã­ã€‚2å›ç›®ã‹ã‚‰ã¯jsonãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã®ã§ã€æ¯”è¼ƒã—å·®åˆ†ãŒãªã„ã®ã§ãƒ†ã‚¹ãƒˆæˆåŠŸã§ã™ã€‚

ã¤ãã«ã€1å›å¤±æ•—ã•ã›ã¦ã¿ã¾ã™ã€‚
ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®å†…å®¹ã‚’é©å½“ã«ã„ã˜ã‚Šã¾ã™ã€‚

```diff
        [
            'name' => 'ã‚Šã‚“ã”',
-           'price' => 150,
+           'price' => 200,
            "stock" => 10,
        ],

```

ã“ã®çŠ¶æ…‹ã§å†åº¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€

```bash
vendor/bin/phpunit tests/SnapshotTest.php
PHPUnit 11.3.1 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.3.10

F                                                                   1 / 1 (100%)

Time: 00:00.017, Memory: 8.00 MB

There was 1 failure:

1) Tests\SnapshotTest::snapshot
Failed asserting that '[{"name":"\u308a\u3093\u3054","price":200,"stock":10},{"name":"\u30d0\u30ca\u30ca","price":200,"stock":5},{"name":"\u307f\u304b\u3093","price":120,"stock":8}]' matches JSON string "[{"name":"\u308a\u3093\u3054","price":150,"stock":10},{"name":"\u30d0\u30ca\u30ca","price":200,"stock":5},{"name":"\u307f\u304b\u3093","price":120,"stock":8}]".

Snapshots can be updated by passing `-d --update-snapshots` through PHPUnit's CLI arguments.
--- Expected
+++ Actual
@@ @@
 [
     {
         "name": "ã‚Šã‚“ã”",
-        "price": 150,
+        "price": 200,
         "stock": 10
     },
```

å¤±æ•—ã—ã¾ã—ãŸã­ã€
ã“ã‚Œã¯ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã§ç”¨æ„ã—ãŸjsonãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã¨é–¢æ•°ãŒè¿”ã™jsonæ–‡å­—åˆ—ã®å†…å®¹ç•°ãªã‚‹ãŸã‚å¤±æ•—ã—ã¾ã—ãŸã€‚
ä»Šå›ã¯æ„å›³çš„ã«å¤‰æ›´ã—ã¦ã„ã¾ã™ãŒã€ã‚‚ã—ä½•ã‚‚ã—ã¦ã„ãªã„ã®ã«jsonæ–‡å­—åˆ—ã®å†…å®¹ãŒå¤‰ã‚ã£ãŸã£ã¦ã„ã†ã“ã¨ãŒã“ã‚Œã§æ¤œçŸ¥ã§ãã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

ã“ã®ã‚ã¨ã¯ã€ä¸å…·åˆãªã‚‰ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ç›´ã™ã“ã¨ã«ãªã‚Šã¾ã™ãŒã€ä»Šå›ã¯ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå´ã‚’å¤‰æ›´ã—ã¾ã™ã€‚
ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…ã«ã‚‚æ›¸ã„ã¦ã‚ã‚‹`-d --update-snapshots`ã‚’å®Ÿè¡Œæ™‚ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æŒ‡å®šã—ã¾ã™ã€‚

```bash
vendor/bin/phpunit tests/SnapshotTest.php -d --update-snapshots 
PHPUnit 11.3.1 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.3.10

I                                                                   1 / 1 (100%)

Time: 00:00.017, Memory: 8.00 MB

OK, but there were issues!
Tests: 1, Assertions: 3, Incomplete: 1.
```

ãã†ã™ã‚‹ã¨åˆå›å®Ÿè¡Œæ™‚ã¨åŒã˜ã‚ˆã†ã«çµæœã¯`I`ï¼ˆæœªå®Œäº†ï¼‰ã¨ãªã‚Šã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®å†ä½œæˆã•ã¦ã€å†ã³å®Ÿè¡Œã™ã‚‹ã¨æˆåŠŸã—ã¾ã™ã­

```bash
vendor/bin/phpunit tests/SnapshotTest.php                      
PHPUnit 11.3.1 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.3.10

.                                                                   1 / 1 (100%)

Time: 00:00.008, Memory: 8.00 MB

OK (1 test, 3 assertions)
```

### Pestã§ã‚„ã£ã¦ã¿ã‚‹

Pestã¯å…ƒã€…æ©Ÿèƒ½ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãã¡ã‚‰ã‚’ä½¿ã„ã¾ã™ã€‚

https://pestphp.com/docs/snapshot-testing

ã§ã¯ã€Pestã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‹ã‚‰é †ç•ªã«ã‚„ã£ã¦ã„ãã¾ã™ã€‚

```bash
composer require pestphp/pest --dev --with-all-dependencies
```

ã“ã®è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ã‚‹æ™‚ç‚¹ã§ã¯ã€ä¸‹è¨˜ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã—ãŸã€‚

```
pestphp/pest 2.35.1
```

ã§ã¯ã€ã¤ãã«ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ä½œã£ã¦ã„ãã¾ã™ã€‚
PHPUnitã«æ¯”ã¹ã‚‹ã¨æ›¸ãé‡ãŒå°‘ãªã„ã§ã™ã­ã€‚

```php:tests/SnapshotTest.php
<?php

declare(strict_types=1);

test('Snapshot-tests', function () {
    expect(json_render())->toMatchSnapshot();
});
```

Pestã®å ´åˆã¯`toMatchSnapshot`ãƒ¡ã‚½ãƒƒãƒ‰ã§è‰²ã€…å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚
expecté–¢æ•°ã«æ¸¡ã™é…åˆ—ã§ã‚‚okã§ã™ã€‚

ã§ã¯ã€ã“ã¡ã‚‰ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

```bash
vendor/bin/pest tests/SnapshotTest.php 

   WARN  Tests\SnapshotTest
  â€¦ Snapshot-tests â†’ Snapshot created at [tests/.pest/snapshots/SnapshotTest/Snapshot_tests.snap]                                                                                                            0.01s  

  Tests:    1 incomplete (0 assertions)
  Duration: 0.07s
```

PHPUnitã¨ä¸€ç·’ã§åˆå›ã¯çµæœãŒ`I`ï¼ˆæœªå®Œäº†ï¼‰ã§ã™ã€‚
å®Ÿè¡Œæ™‚ã«è¡¨ç¤ºã—ã¦ã„ã¾ã™ãŒã€Pestã‚‚åˆå›ã¯ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆãŒå‹•ãã¾ã™ã€‚
phpunit-snapshot-assertionsã¨ã¯ç•°ãªã‚Šã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¯`tests/.pest/snapshots`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«ä½œã‚‰ã‚Œã¾ã™ã€‚

ä»Šå›ä½œã‚‰ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã—ãŸã€‚

```bash
tree -a tests

tests
â”œâ”€â”€ .pest
â”‚Â Â  â””â”€â”€ snapshots
â”‚Â Â      â””â”€â”€ SnapshotTest
â”‚Â Â          â””â”€â”€ Snapshot_tests.snap
â””â”€â”€ SnapshotTest.php
```

ãƒ•ã‚¡ã‚¤ãƒ«åã¯ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‹ã‚‰æ¡ç”¨ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

ä¸­èº«ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚
PHPUnitã®æ–¹ã¨åŒæ§˜ã§æ—¥æœ¬èªã®æ–‡å­—åˆ—ã¯Unicodeã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚Œã¦ã„ã¾ã™ã­ã€‚

```json:tests/.pest/snapshots/SnapshotTest/Snapshot_tests.snap
[{"name":"\u308a\u3093\u3054","price":150,"stock":10},{"name":"\u30d0\u30ca\u30ca","price":200,"stock":5},{"name":"\u307f\u304b\u3093","price":120,"stock":8}]
```

ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚ŒãŸã®ã§å†åº¦å®Ÿè¡Œã™ã‚‹ã¨æˆåŠŸã§ã™ã­ã€‚

```bash
vendor/bin/pest tests/SnapshotTest.php

   PASS  Tests\SnapshotTest
  âœ“ Snapshot-tests                                                                                                                                                                                        0.01s  

  Tests:    1 passed (1 assertions)
  Duration: 0.07s
```

ã§ã¯ã€Pestã®æ–¹ã§ã‚‚1å›å¤±æ•—ã•ã›ã¦ã¿ã¾ã™ã€‚
ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®å†…å®¹ã‚’é©å½“ã«ã„ã˜ã‚Šã¾ã™ã€‚

```diff
        [
            'name' => 'ãƒãƒŠãƒŠ',
            'price' => 200,
-           'stock' => 5,
+           'stock' => 0,
        ],
```

ã“ã®çŠ¶æ…‹ã§å†åº¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€

```bash
vendor/bin/pest tests/SnapshotTest.php

   FAIL  Tests\SnapshotTest
  â¨¯ Snapshot-tests                                                                                                                                                                                        0.01s  
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\SnapshotTest > Snapshot-tests                                                                                                                                                                   
  Failed asserting that the string value matches its snapshot (tests/.pest/snapshots/SnapshotTest/Snapshot_tests.snap).
Failed asserting that two strings are identical.
  -'[{"name":"\u308a\u3093\u3054","price":150,"stock":10},{"name":"\u30d0\u30ca\u30ca","price":200,"stock":5},{"name":"\u307f\u304b\u3093","price":120,"stock":8}]'
  +'[{"name":"\u308a\u3093\u3054","price":150,"stock":10},{"name":"\u30d0\u30ca\u30ca","price":200,"stock":0},{"name":"\u307f\u304b\u3093","price":120,"stock":8}]'
```

ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®å†…å®¹ã¨ç•°ãªã‚‹çµæœã«ãªã£ãŸã®ã§å¤±æ•—ã—ã¾ã—ãŸã­ã€‚
PHPUnitã¨åŒæ§˜ã€ä½•ã‚‚ã—ã¦ã„ãªã„ã®ã«å¤±æ•—ã—ãŸå ´åˆã€ä¸å…·åˆãªã‚‰ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ç›´ã™ã“ã¨ã«ãªã‚Šã¾ã™ãŒã€æ„å›³çš„ã«å¤‰æ›´ã—ã¦ã„ã‚‹ã®ã§ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå´ã‚’å¤‰æ›´ã—ã¾ã™ã€‚

å¤‰æ›´ã™ã‚‹å ´åˆã¯`--update-snapshots`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
vendor/bin/pest tests/SnapshotTest.php --update-snapshots

   WARN  Tests\SnapshotTest
  â€¦ Snapshot-tests â†’ Snapshot created at [tests/.pest/snapshots/SnapshotTest/Snapshot_tests.snap]                                                                                                            0.01s  

  Tests:    1 incomplete (0 assertions)
  Duration: 0.06s
```

å…ˆã»ã©ã¨ä¸€ç·’ã§ã™ã­ã€‚æœªå®Œäº†ã§1å›çµ‚ã‚ã‚Šã€å†åº¦å®Ÿè¡Œã™ã‚‹ã¨æˆåŠŸã—ã¾ã™ã€‚

```bash
vendor/bin/pest tests/SnapshotTest.php                   

   PASS  Tests\SnapshotTest
  âœ“ Snapshot-tests                                                                                                                                                                                        0.01s  

  Tests:    1 passed (1 assertions)
  Duration: 0.06s
```

## ã¾ã¨ã‚

ä»Šå›ã¯PHPã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’PHPUnitã¨Pestã§è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚
å‰²ã¨ç°¡å˜ã«å®Ÿæ–½ã§ãã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã­ã€‚

PHPUnitã¨Pestã®ã©ã¡ã‚‰ã‚’æ¡ç”¨ã™ã‚‹ã‹ã¯å¥½ã¿ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ãŒã€
å®Ÿéš›ã«ã¯APIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å¯¾ã—ã¦ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’ä½¿ã†ã¨ã‚‚ã£ã¨åŠ¹æœçš„ã«æ´»ç”¨ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

æœ€å¾Œã«ä»Šå›ä½¿ã£ãŸã‚³ãƒ¼ãƒ‰ã¯ã“ã¡ã‚‰ã«ç½®ã„ã¦ã‚ã‚Šã¾ã™ã€‚

https://github.com/naopusyu/sandbox/tree/main/php/phpunit-snapshot-tests
https://github.com/naopusyu/sandbox/tree/main/php/pest-snapshot-tests