---
title: "Laravel11 cacheã‚³ãƒãƒ³ãƒ‰"
emoji: "ğŸŒ¿"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [
    "laravel",
    "php"
]
published: true
published_at: "2024-12-03 06:00"
---

ã“ã®è¨˜äº‹ã¯ [Laravel11ã«ã‚ã‚‹Artisanã‚³ãƒãƒ³ãƒ‰ã‚’å…¨éƒ¨èª¿ã¹ã‚‹ Advent Calendar 2024](https://adventar.org/calendars/10674) 3æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

ä»Šå›ã¯cacheã‚³ãƒãƒ³ãƒ‰ã«ã¤ã„ã¦èª¿ã¹ã¾ã—ãŸã€‚

## ç’°å¢ƒ

- PHP 8.4.1
- laravel/laravel 11.3.3
- laravel/framework 11.33.2

## cache:clear

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ã™ã‚‹ã€‚

```
php artisan cache:clear [<store>]
```

å®Ÿè¡Œã™ã‚‹ã¨ä½¿ç”¨ã—ã¦ã„ã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¹ãƒˆã‚¢ï¼ˆdatabaseãªã©ï¼‰ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨storage/framework/cacheãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¾ã™ã€‚

| å¼•æ•° | èª¬æ˜ |
| --- | --- |
| `store` | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¹ãƒˆã‚¢ã‚’æŒ‡å®š |

- `store`ã«ã¯config/cache.phpã®storesã«æ›¸ã‹ã‚Œã¦ã„ã‚‹å†…å®¹ã‚’æŒ‡å®šã§ãã¾ã™
  - æœªæŒ‡å®šã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®databaseã«ãªã‚Šã¾ã™
  - ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã®ã¯"array", "database", "file", "memcached","redis", "dynamodb", "octane", "null"ã§ã™

```
php artisan cache:clear redis
```

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ |
| --- | --- |
| `--tags[=TAGS]` | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’æŒ‡å®š |

- `--tags`ã‚’ä»˜ã‘ã‚‹ã“ã¨ã§ã‚¿ã‚°ã‚’æŒ‡å®šã§å‰Šé™¤ã‚‚ã§ãã¾ã™
  - ã‚¿ã‚°ãŒåˆ©ç”¨ã§ããªã„ã‚¹ãƒˆã‚¢ã§ã¯æŒ‡å®šã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™

```
advent-calendar-2024 % php artisan cache:clear database --tags=abc,abc

   BadMethodCallException 

  This cache store does not support tagging.
```

## cache:forget

ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰é …ç›®ã‚’å‰Šé™¤ã™ã‚‹ã€‚

```
php artisan cache:forget <key> [<store>]
```

å®Ÿè¡Œã™ã‚‹ã¨ä½¿ç”¨ã—ã¦ã„ã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¹ãƒˆã‚¢ã®æŒ‡å®šã—ãŸé …ç›®ã‚’å‰Šé™¤ã—ã¾ã™ã€‚

| å¼•æ•° | èª¬æ˜ |
| --- | --- |
| `key` | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚­ãƒ¼ã‚’æŒ‡å®š |
| `store` | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¹ãƒˆã‚¢ã‚’æŒ‡å®š |

- `key`ã¯å‰Šé™¤ã—ãŸã„ã‚­ãƒ¼ã‚’æŒ‡å®šã—ã¾ã™ã€æœªæŒ‡å®šã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™
- `store`ã«ã¯config/cache.phpã®storesã«æ›¸ã‹ã‚Œã¦ã„ã‚‹å†…å®¹ã‚’æŒ‡å®šã§ãã¾ã™  
  - æœªæŒ‡å®šã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®databaseã«ãªã‚Šã¾ã™
  - ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã®ã¯"array", "database", "file", "memcached","redis", "dynamodb", "octane", "null"ã§ã™

```
php artisan cache:forget key database
```

## cache:prune-stale-tags

ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å¤ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’å‰Šé™¤ã™ã‚‹ã€‚

```
php artisan cache:prune-stale-tags [<store>]
```

:::message
ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯Redisé™å®šã§ã™ã€‚
ãã®ã»ã‹ã®ã‚¹ãƒˆã‚¢ã§å®Ÿè¡Œã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

```
advent-calendar-2024 % php artisan cache:prune-stale-tags database

   ERROR  Pruning cache tags is only necessary when using Redis.  
```
:::

| å¼•æ•° | èª¬æ˜ |
| --- | --- |
| `store` | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¹ãƒˆã‚¢ã‚’æŒ‡å®š |

- config/cache.phpã®storesã«æ›¸ã‹ã‚Œã¦ã„ã‚‹å†…å®¹ã‚’æŒ‡å®šã§ãã¾ã™
  - æœªæŒ‡å®šã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®databaseã«ãªã‚Šã¾ã™
  - ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã®ã¯"array", "database", "file", "memcached","redis", "dynamodb", "octane", "null"ã§ã™
  - ãŸã ã—ã€ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯Redisé™å®šãªã®ã§"redis"ä»¥å¤–ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã¯ãªã•ãã†ã§ã™

```
php artisan cache:prune-stale-tags redis
```
