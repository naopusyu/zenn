---
title: "コマンドを簡略化するためにTaskfileを試す！"
emoji: "🌿"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [
  "taskfile"
]
published: false
---

## はじめに

普段Zennの記事を書く時に利用しているコマンドがいくつかあります。
今回そのコマンドをTaskfileを使って簡略化できるか試してみます。

https://taskfile.dev/

:::message
事前に`zenn-cli`と`textlint`をインストールが完了している前提です。
:::

## Taskfileを使う準備

まずはインストールを行う。

[公式ドキュメント](https://taskfile.dev/docs/installation)に色々な方法が書かれていますが、今回はMac環境なのでHomebrewを使います。

```bash
brew install go-task
```

インストール後、taskコマンドに`--init`オプションを付けて実行し、Taskfile.ymlを生成します。

```bash
task --init
```

:::message
あとで書き換えるので生成された初期状態のファイルの内容については今回は触れません。
:::

これでTaskfileを使う準備ができました。

## タスクの定義

タスクに定義するのは次のzenn cliのコマンドにします。
（どうしてもコマンドを覚えられないです😭）

- 記事の新規作成（`npx zenn new:article`）
- プレビュー（`npx zenn preview`）

あと、textlint（`npx textlint`）も含めておきます。

Taskfile.ymlに書くタスクの定義は`tasks`以下のキーがタスク名、その次の`cmds`に実行するコマンドを書きます。

実際に書くと以下のようになります。

```yaml
# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: '3'

silent: true

tasks:
  new:
    cmds:
      - npx zenn new:article --emoji 🌿 --published false
    desc: '新しい記事を追加'

  preview:
    cmds:
      - npx zenn preview
    desc: 'コンテンツのプレビュー'

  textlint:
    cmds:
      - npx textlint -f pretty-error {{.CLI_ARGS}}
    ignore_error: true
    desc: 'textlintの実行'
```

記事の新規作成ではオプションでemojiの指定と、非公開で作成するようにしています。

`silent: true`はコマンドの結果だけ出力する設定です。
`desc`はタスクの説明です。

taskコマンドに--list（-l）オプションを付けて実行するとタスクの一覧を表示する時の説明に使われます。

```bash
task --list
task: Available tasks for this project:
* new:            新しい記事を追加
* preview:        コンテンツのプレビュー
* textlint:       textlintの実行
```

textlintのところで使っている`{{.CLI_ARGS}}`はコマンドラインから引数を受け取るために使います。
`ignore_error: true`はtextlintでエラーが起きても抑制し、最後までコマンドを実行してくれます。

## タスクを使う

taskコマンドの後に定義したタスク名を指定すれば実行できます。

```bash
task new
created: articles/fda95a19a93757.md
```

emojiが指定され、非公開設定でファイルが作成されています。

```bash
cat articles/fda95a19a93757.md
---
title: ""
emoji: "🌿"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---
```

textlintタスクを実行する時は引数でファイル名の指定が必要です。

```bash
task textlint -- articles/fda95a19a93757.md
```

## まとめ

今回Taskfileを試すためにZennの記事を書く時に使っている各種コマンドをタスクにしました。

複雑なことはせず、コマンド実行時の引数指定を簡略化したくらいですが、使ってみるとかなり便利です。

Taskfileには他にも便利な機能がたくさんあります。
公式ドキュメントを読んでもっと活用していきたいですね！

https://taskfile.dev/docs/guide
