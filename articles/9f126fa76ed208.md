---
title: "PHPStanã®Baselineã£ã¦PHPãƒ•ã‚¡ã‚¤ãƒ«ã§ä½œã‚Œã‚‹ã‚‰ã—ã„ã­"
emoji: "ğŸ‘‹"
type: "tech"
topics:
  - "php"
  - "phpstan"
published: true
published_at: "2023-06-05 01:17"
---

## ã¯ã˜ã‚ã«

PHPStanã®Baselineã®ä½œã‚Šæ–¹ãªã©ã‚’èª¿ã¹ã‚‹ãŸã‚ã«ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚’çœºã‚ã¦ã„ãŸã‚‰ã€PHPãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã‚‚ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã§ã™ã€‚

https://phpstan.org/user-guide/baseline#php-baseline-format-instead-of-neon

ãã“ã§PHPãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚’è©¦ã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

## ç’°å¢ƒ

- PHP 8.2.6
- PHPStan 1.10.15

## ã„ã¤ã‹ã‚‰ä½œæˆã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸ

ã„ã¤ã”ã‚ã‹ã‚‰ä½œæˆã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã‹ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã‚’è¦‹ã‚‹ã¨1.10.2ã‹ã‚‰ã®ã‚ˆã†ã§ã™ã­ã€‚
https://github.com/phpstan/phpstan/releases/tag/1.10.2

## ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

PHPStanã§è§£æã™ã‚‹ã‚³ãƒ¼ãƒ‰ã¯[ã“ã¡ã‚‰](https://github.com/naopusyu/phpstan-baseline-php-format)ã«ç”¨æ„ã—ãŸå†…å®¹ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

â€»ï¼‘ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ãªã®ã§è¼‰ã›ã¦ãŠãã¾ã™ã€‚

```php:src/index.php
<?php

// å­˜åœ¨ã—ãªã„ã‚¯ãƒ©ã‚¹
$model = new Model();

// å­˜åœ¨ã—ãªã„é–¢æ•°
func();

class Sample
{
    public function get()
    {
        // æœªå®šç¾©ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
        return $this->property;
    }
}
```

ã¨ã‚Šã‚ãˆãšã€è©¦ã—ã«**ãƒ¬ãƒ™ãƒ«0**ã§è§£æã—ã¦ã¿ã‚‹ã¨ä½•ã‹ã—ã‚‰ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ã¾ã™ã­ã€‚

```bash
vendor/bin/phpstan analyse src -l 0 
 1/1 [â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“] 100%

 ------ -------------------------------------------------------------------------------------- 
  Line   index.php
 ------ -------------------------------------------------------------------------------------- 
  4      Instantiated class Model not found.
         ğŸ’¡ Learn more at https://phpstan.org/user-guide/discovering-symbols
  7      Function func not found.
         ğŸ’¡ Learn more at https://phpstan.org/user-guide/discovering-symbols
  14     Access to an undefined property Sample::$property.
         ğŸ’¡ Learn more: https://phpstan.org/blog/solving-phpstan-access-to-undefined-property
 ------ -------------------------------------------------------------------------------------- 
                                           
 [ERROR] Found 3 errors
 
```

## PHPãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚’è©¦ã—ã¦ã¿ã¾ã™

ã¾ãšã¯PHPãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§Baselineã‚’ä½œæˆã—ã¾ã™ã€‚

ä½œæˆã™ã‚‹ã«ã¯Baselineã‚’ä½œæˆã™ã‚‹æ™‚ã¨åŒã˜ã‚ªãƒ—ã‚·ãƒ§ãƒ³(`--generate-baseline|-b`)ã‚’ä½¿ã„ã€
ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ãŒ`.php`ã‚’æŒ‡å®šã—ã¦ãŠã‘ã°å¤§ä¸ˆå¤«ãªã‚ˆã†ã§ã™ã€‚

```bash
vendor/bin/phpstan analyse src -l 0 -b phpstan-baseline.php
 1/1 [â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“] 100%
 
 [OK] Baseline generated with 3 errors.
 
```

`phpstan-baseline.php`ãŒå‡ºæ¥ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚
â€»ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æŒ‡å®šã—ã¦ã„ãªã„å ´åˆã¯ã€`phpstan-baseline.neon`ã§ä½œæˆã•ã‚Œã¾ã™ã­ã€‚

ä¸­èº«ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™

```php:phpstan-baseline.php
<?php declare(strict_types = 1);

$ignoreErrors = [];
$ignoreErrors[] = [
	'message' => '#^Access to an undefined property Sample\\:\\:\\$property\\.$#',
	'count' => 1,
	'path' => __DIR__ . '/src/index.php',
];
$ignoreErrors[] = [
	'message' => '#^Function func not found\\.$#',
	'count' => 1,
	'path' => __DIR__ . '/src/index.php',
];
$ignoreErrors[] = [
	'message' => '#^Instantiated class Model not found\\.$#',
	'count' => 1,
	'path' => __DIR__ . '/src/index.php',
];

return ['parameters' => ['ignoreErrors' => $ignoreErrors]];

```

â€» ã¡ãªã¿ã«neonãƒ•ã‚¡ã‚¤ãƒ«ã ã¨ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚

```neon:phpstan-baseline.neon
parameters:
        ignoreErrors:
                -
                        message: "#^Access to an undefined property Sample\\:\\:\\$property\\.$#"
                        count: 1
                        path: src/index.php

                -
                        message: "#^Function func not found\\.$#"
                        count: 1
                        path: src/index.php

                -
                        message: "#^Instantiated class Model not found\\.$#"
                        count: 1
                        path: src/index.php
```

æ¬¡ã«`phpstan-baseline.php`ã‚’`phpstan.neon`ã§èª­ã¿è¾¼ã¿ã¾ã™ã€‚
ã¤ã„ã§ã«`path`ã¨`level`ã®æŒ‡å®šã‚‚ã“ã¡ã‚‰ã«æ›¸ã„ã¦ãŠãã¾ã™ã€‚

```neon:phpstan.neon
includes:
    - phpstan-baseline.php

parameters:
    paths:
        - src
    level: 0
```

èª­ã¿è¾¼ã‚“ã çŠ¶æ…‹ã§æ”¹ã‚ã¦è§£æã—ã¦ã¿ã¾ã™ã€‚

```bash
vendor/bin/phpstan analyse -c phpstan.neon
 1/1 [â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“] 100%
 
 [OK] No errors
 
```

ã‚¨ãƒ©ãƒ¼ã¯ç„¡ããªã‚Šã¾ã—ãŸã­ã€‚

## ã¾ã¨ã‚

ä»Šå›ã¯ã€PHPãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã®Baselineã‚’è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚
neonãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã®æ™‚ã«æ¯”ã¹ã‚‹ã¨PHPãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã®æ–¹ãŒæ…£ã‚Œã¦ã„ã‚‹ã®ã§å¤§å¤‰è¦‹ã‚„ã™ã„ã§ã™ã­ã€‚

ã¾ãŸã€[ãƒãƒ‹ãƒ¥ã‚¢ãƒ«](https://phpstan.org/user-guide/baseline#php-baseline-format-instead-of-neon)ã«ã¯ã€**neonãƒ•ã‚¡ã‚¤ãƒ«ã§ä½œã‚‹ã‚ˆã‚Šã‚‚ã€è§£æãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€ãƒ¡ãƒ¢ãƒªæ¶ˆè²»ã‚’è»½æ¸›ã™ã‚‹ã®ã«å½¹ç«‹ã¤å¯èƒ½æ€§ãŒã‚ã‚‹**ã¨æ›¸ã‹ã‚Œã¦ã„ã‚‹ã®ã§ã€åˆ©ç”¨å¯èƒ½ãªãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ã€PHPãƒ•ã‚¡ã‚¤ãƒ«ã§ä½œã£ãŸæ–¹ãŒã„ã„ã®ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã­ã€‚
